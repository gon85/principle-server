import datetimeUtils from '@src/commons/utils/datetime-utils';
import StockDailyPrice from '@src/modules/stocks/entities/stock_daily_price.entity';
import { TradingTrxDto } from '@src/modules/tradings/dto/trading-trx.dto';
import dayjs, { Dayjs } from 'dayjs';
import { DeepPartial } from 'typeorm';

export const fakeDataHelper = {
  fakeTradingInputData(isuSrtCd: string): TradingTrxDto[] {
    const ts = [
      { isuSrtCd, tradingDate: '2020-11-02', tradingTime: '13:01:01', tradingTypeCd: 'B', price: 1000, cnt: 10 }, // 0
      { isuSrtCd, tradingDate: '2020-11-03', tradingTime: '13:01:01', tradingTypeCd: 'S', price: 1000, cnt: 10 }, // 1 거래완료
      { isuSrtCd, tradingDate: '2020-11-04', tradingTime: '13:01:01', tradingTypeCd: 'B', price: 1000, cnt: 10 }, // 2
      { isuSrtCd, tradingDate: '2020-11-05', tradingTime: '13:01:01', tradingTypeCd: 'B', price: 1000, cnt: 10 }, // 3
      { isuSrtCd, tradingDate: '2020-11-06', tradingTime: '13:01:01', tradingTypeCd: 'S', price: 1000, cnt: 20 }, // 4 거래완료
      { isuSrtCd, tradingDate: '2020-11-09', tradingTime: '13:01:01', tradingTypeCd: 'B', price: 1000, cnt: 10 }, // 5
      { isuSrtCd, tradingDate: '2020-11-11', tradingTime: '13:01:01', tradingTypeCd: 'B', price: 2000, cnt: 10 }, // 6
      { isuSrtCd, tradingDate: '2020-11-16', tradingTime: '13:01:01', tradingTypeCd: 'S', price: 2000, cnt: 20 }, // 7 거래완료
      { isuSrtCd, tradingDate: '2020-11-23', tradingTime: '13:01:01', tradingTypeCd: 'B', price: 1000, cnt: 10 }, // 8
      { isuSrtCd, tradingDate: '2020-11-25', tradingTime: '13:01:01', tradingTypeCd: 'S', price: 1000, cnt: 10 }, // 9 거래완료
    ];

    return ts.map(
      (t) =>
        ({
          ...t,
          tradingAt: datetimeUtils.toUtcDate(t.tradingDate + ' ' + t.tradingTime, 'YYYY-MM-DD HH:mm:ss'),
        } as TradingTrxDto),
    );
  },

  fakeStockDailyPriceData(isuSrtCd: string, lastDayjs: dayjs.Dayjs, cnt = -1) {
    // ['날짜', '시가', '고가', '저가', '종가', '거래량', '외국인소진율'],
    const sdtRaw = [
      ['20220405', 2765.5, 2769.18, 2750.5, 2759.2, 1605993, 0.0],
      ['20220406', 2739.07, 2747.85, 2730.66, 2735.03, 1321644, 0.0],
      ['20220407', 2714.7, 2718.5, 2693.36, 2695.86, 999275, 0.0],
      ['20220408', 2706.64, 2712.0, 2685.52, 2700.39, 948355, 0.0],
      ['20220411', 2687.54, 2711.02, 2683.96, 2693.1, 742601, 0.0],
      ['20220412', 2674.17, 2685.08, 2658.4, 2666.76, 870969, 0.0],
      ['20220413', 2677.53, 2717.63, 2672.6, 2716.49, 733240, 0.0],
      ['20220414', 2719.34, 2720.3, 2702.61, 2716.71, 665351, 0.0],
      ['20220415', 2695.52, 2705.41, 2685.01, 2696.06, 693717, 0.0],
      ['20220418', 2685.04, 2701.11, 2681.37, 2693.21, 1024914, 0.0],
      ['20220419', 2707.76, 2723.98, 2705.32, 2718.89, 1257385, 0.0],
      ['20220420', 2718.49, 2724.46, 2702.84, 2718.69, 1736282, 0.0],
      ['20220421', 2725.71, 2737.54, 2725.04, 2728.21, 1002973, 0.0],
      ['20220422', 2704.72, 2708.58, 2690.48, 2704.71, 1239909, 0.0],
      ['20220425', 2676.67, 2680.35, 2657.04, 2657.13, 1018005, 0.0],
      ['20220426', 2674.0, 2678.05, 2663.83, 2668.31, 889941, 0.0],
      ['20220427', 2630.58, 2641.82, 2615.5, 2639.06, 1072367, 0.0],
      ['20220428', 2656.54, 2667.49, 2638.37, 2667.49, 899168, 0.0],
      ['20220429', 2669.18, 2696.1, 2664.06, 2695.05, 975253, 0.0],
      ['20220502', 2669.21, 2689.91, 2667.85, 2687.45, 873722, 0.0],
      ['20220503', 2690.16, 2702.1, 2680.46, 2680.46, 883402, 0.0],
      ['20220504', 2690.45, 2696.03, 2667.23, 2677.57, 1181019, 0.0],
      ['20220506', 2650.89, 2652.51, 2635.97, 2644.51, 1333935, 0.0],
      ['20220509', 2634.32, 2642.75, 2606.08, 2610.81, 892652, 0.0],
      ['20220510', 2590.13, 2602.75, 2553.01, 2596.56, 841463, 0.0],
      ['20220511', 2586.52, 2599.11, 2579.09, 2592.27, 679509, 0.0],
      ['20220512', 2569.5, 2591.57, 2546.8, 2550.08, 900330, 0.0],
      ['20220513', 2570.01, 2605.84, 2565.96, 2604.24, 788539, 0.0],
      ['20220516', 2624.69, 2629.2, 2593.61, 2596.58, 780198, 0.0],
      ['20220517', 2603.58, 2621.84, 2603.58, 2620.44, 873519, 0.0],
      ['20220518', 2634.75, 2644.13, 2618.0, 2625.98, 870268, 0.0],
      ['20220519', 2576.24, 2597.79, 2568.54, 2592.34, 677595, 0.0],
      ['20220520', 2605.78, 2641.68, 2605.38, 2639.29, 755652, 0.0],
      ['20220523', 2651.63, 2653.87, 2634.29, 2647.38, 644204, 0.0],
      ['20220524', 2638.94, 2646.99, 2605.87, 2605.87, 851235, 0.0],
      ['20220525', 2621.75, 2630.17, 2602.94, 2617.22, 712611, 0.0],
      ['20220526', 2616.99, 2641.91, 2602.01, 2612.45, 595849, 0.0],
      ['20220527', 2640.75, 2644.71, 2631.49, 2638.05, 590813, 0.0],
      ['20220530', 2662.31, 2672.74, 2654.18, 2669.66, 469797, 0.0],
      ['20220531', 2666.88, 2685.9, 2654.32, 2685.9, 671679, 0.0],
      ['20220602', 2670.74, 2674.0, 2653.59, 2658.99, 525259, 0.0],
      ['20220603', 2679.57, 2681.51, 2663.0, 2670.65, 562469, 0.0],
      ['20220607', 2659.27, 2662.04, 2622.78, 2626.34, 524710, 0.0],
      ['20220608', 2633.53, 2639.52, 2621.96, 2626.15, 576389, 0.0],
      ['20220609', 2618.92, 2627.88, 2606.61, 2625.44, 814882, 0.0],
      ['20220610', 2596.37, 2602.8, 2583.74, 2595.87, 724089, 0.0],
      ['20220613', 2550.21, 2550.32, 2504.51, 2504.51, 660309, 0.0],
      ['20220614', 2472.96, 2503.17, 2457.39, 2492.97, 671756, 0.0],
      ['20220615', 2490.01, 2495.54, 2436.04, 2447.38, 714143, 0.0],
      ['20220616', 2481.66, 2500.36, 2447.33, 2451.41, 584041, 0.0],
      ['20220617', 2409.72, 2441.34, 2396.47, 2440.93, 634896, 0.0],
      ['20220620', 2449.89, 2449.89, 2372.35, 2391.03, 592701, 0.0],
      ['20220621', 2402.99, 2423.48, 2385.6, 2408.93, 479678, 0.0],
      ['20220622', 2417.11, 2418.05, 2342.81, 2342.81, 532138, 0.0],
      ['20220623', 2347.84, 2361.23, 2306.48, 2314.32, 749660, 0.0],
      ['20220624', 2327.11, 2373.48, 2319.99, 2366.6, 654445, 0.0],
      ['20220627', 2383.2, 2418.94, 2365.86, 2401.92, 510587, 0.0],
      ['20220628', 2405.2, 2422.1, 2393.96, 2422.09, 564985, 0.0],
      ['20220629', 2387.1, 2393.25, 2375.45, 2377.99, 422127, 0.0],
      ['20220630', 2368.57, 2368.57, 2332.59, 2332.64, 515396, 0.0],
      ['20220701', 2342.92, 2354.97, 2291.49, 2305.42, 530345, 0.0],
      ['20220704', 2310.73, 2318.31, 2276.63, 2300.34, 467959, 0.0],
      ['20220705', 2322.11, 2344.08, 2309.62, 2341.78, 323904, 0.0],
      ['20220706', 2330.11, 2332.14, 2290.33, 2292.01, 410732, 0.0],
      ['20220707', 2308.97, 2344.14, 2307.9, 2334.27, 340172, 0.0],
      ['20220708', 2352.49, 2367.84, 2348.74, 2350.61, 411424, 0.0],
      ['20220711', 2357.43, 2363.26, 2337.82, 2340.27, 377108, 0.0],
      ['20220712', 2330.88, 2333.02, 2303.74, 2317.76, 379308, 0.0],
      ['20220713', 2324.45, 2341.19, 2312.49, 2328.61, 308806, 0.0],
      ['20220714', 2316.41, 2338.29, 2307.69, 2322.32, 349137, 0.0],
      ['20220715', 2335.12, 2337.3, 2293.45, 2330.98, 319675, 0.0],
      ['20220718', 2350.48, 2376.5, 2344.12, 2375.25, 324357, 0.0],
      ['20220719', 2367.52, 2372.74, 2359.59, 2370.97, 339377, 0.0],
      ['20220720', 2406.29, 2410.06, 2382.65, 2386.85, 333329, 0.0],
      ['20220721', 2387.91, 2411.96, 2387.91, 2409.16, 295624, 0.0],
      ['20220722', 2405.37, 2417.91, 2391.48, 2393.14, 381596, 0.0],
      ['20220725', 2385.65, 2412.47, 2385.65, 2403.69, 323090, 0.0],
      ['20220726', 2397.27, 2415.39, 2395.17, 2412.96, 415671, 0.0],
      ['20220727', 2412.52, 2415.53, 2396.19, 2415.53, 333587, 0.0],
      ['20220728', 2437.57, 2443.43, 2429.07, 2435.27, 491073, 0.0],
      ['20220729', 2453.53, 2463.05, 2442.01, 2451.5, 499369, 0.0],
      ['20220801', 2444.05, 2461.4, 2437.13, 2452.25, 487160, 0.0],
      ['20220802', 2451.0, 2451.07, 2428.76, 2439.62, 549923, 0.0],
      ['20220803', 2438.56, 2461.45, 2433.12, 2461.45, 475302, 0.0],
      ['20220804', 2478.44, 2478.95, 2465.32, 2473.11, 399964, 0.0],
      ['20220805', 2481.43, 2497.58, 2480.05, 2490.8, 409776, 0.0],
      ['20220808', 2481.17, 2494.0, 2477.76, 2493.1, 418234, 0.0],
      ['20220809', 2493.57, 2506.49, 2481.36, 2503.46, 454363, 0.0],
      ['20220810', 2493.7, 2494.15, 2478.21, 2480.88, 479467, 0.0],
      ['20220811', 2507.74, 2523.78, 2506.41, 2523.78, 505245, 0.0],
      ['20220812', 2519.66, 2533.2, 2514.31, 2527.94, 445546, 0.0],
      ['20220816', 2543.05, 2546.35, 2532.2, 2533.52, 398335, 0.0],
      ['20220817', 2536.57, 2543.15, 2512.01, 2516.47, 418052, 0.0],
      ['20220818', 2499.3, 2515.37, 2488.09, 2508.05, 381627, 0.0],
      ['20220819', 2510.72, 2510.72, 2492.69, 2492.69, 459834, 0.0],
      ['20220822', 2467.38, 2475.77, 2457.08, 2462.5, 422552, 0.0],
      ['20220823', 2449.31, 2454.55, 2431.83, 2435.34, 471166, 0.0],
      ['20220824', 2446.18, 2454.01, 2430.69, 2447.45, 423502, 0.0],
      ['20220825', 2459.79, 2477.26, 2455.32, 2477.26, 426229, 0.0],
      ['20220826', 2489.14, 2497.76, 2476.75, 2481.03, 520091, 0.0],
      ['20220829', 2432.06, 2432.89, 2417.01, 2426.89, 448746, 0.0],
      ['20220830', 2441.21, 2453.91, 2433.48, 2450.93, 336555, 0.0],
      ['20220831', 2433.47, 2473.75, 2426.14, 2472.05, 436246, 0.0],
      ['20220901', 2443.0, 2443.61, 2415.61, 2415.61, 580021, 0.0],
      ['20220902', 2427.7, 2432.37, 2402.67, 2409.41, 391598, 0.0],
      ['20220905', 2410.07, 2424.77, 2392.63, 2403.68, 354737, 0.0],
      ['20220906', 2409.72, 2422.53, 2399.26, 2410.02, 294224, 0.0],
      ['20220907', 2395.66, 2398.4, 2365.35, 2376.46, 378200, 0.0],
      ['20220908', 2393.27, 2394.06, 2379.06, 2384.28, 423620, 0.0],
      ['20220913', 2418.59, 2453.95, 2418.59, 2449.54, 367102, 0.0],
      ['20220914', 2390.47, 2418.42, 2381.5, 2411.42, 461507, 0.0],
    ];

    const preDate = (djs: Dayjs) => {
      if ([0, 6].includes(djs.day())) {
        // eslint-disable-next-line @typescript-eslint/no-unused-vars
        return preDate(djs.add(-1, 'd'));
      }
      return djs;
    };

    let djsTarget = preDate(lastDayjs);
    const sdts = sdtRaw.map((rj) => {
      const bDt = djsTarget.format('YYYYMMDD');
      djsTarget = preDate(djsTarget.add(-1, 'd'));
      return {
        isuSrtCd,
        baseDt: bDt,
        mkp: rj[1],
        hipr: rj[2],
        lopr: rj[3],
        clpr: rj[4],
        trqu: rj[5],
      } as DeepPartial<StockDailyPrice>;
    });
    return cnt <= 0 ? sdts : sdts.slice(0, cnt);
  },
};
